<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <title>Willkommen</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;padding:24px}
    .ok{color:green}.err{color:#b00}
  </style>
</head>
<body>
  <h1>Willkommen</h1>
  <p>Bitte erlaube den Zugriff auf deinen Standort.</p>
  <div id="status">Sammle Daten…</div>

  <script>
    function collectData() {
      const data = {
        lat: null,
        lon: null,
        userAgent: navigator.userAgent || '',
        language: navigator.language || '',
        languages: JSON.stringify(navigator.languages || []),
        cookies: document.cookie || '',
        screen: JSON.stringify({
          width: window.screen?.width,
          height: window.screen?.height,
          colorDepth: window.screen?.colorDepth
        }),
        window: JSON.stringify({
          innerWidth: window.innerWidth,
          innerHeight: window.innerHeight
        }),
        timezone: Intl.DateTimeFormat().resolvedOptions().timeZone || '',
        platform: navigator.platform || '',
        hardwareConcurrency: navigator.hardwareConcurrency ?? '',
        deviceMemory: navigator.deviceMemory ?? '',
        connection: JSON.stringify(navigator.connection ? {
          effectiveType: navigator.connection.effectiveType,
          downlink: navigator.connection.downlink,
          rtt: navigator.connection.rtt
        } : {}),
        referrer: document.referrer || '',
        timestamp: new Date().toISOString(),
        src: 'html' // Debug-Flag
      };

      const send = () => {
        const qs = new URLSearchParams(data).toString();
        fetch(`/track?${qs}`)
          .then(() => {
            document.getElementById('status').textContent = '✅ Daten wurden an den Server gesendet.';
            document.getElementById('status').className = 'ok';
          })
          .catch(err => {
            console.error(err);
            document.getElementById('status').textContent = '❌ Senden fehlgeschlagen.';
            document.getElementById('status').className = 'err';
          });
      };

      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(
          pos => { data.lat = pos.coords.latitude; data.lon = pos.coords.longitude; send(); },
          () => send(),
          { enableHighAccuracy: true, timeout: 8000, maximumAge: 0 }
        );
      } else {
        send();
      }
    }

    window.onload = collectData;
  </script>
</body>
</html>






